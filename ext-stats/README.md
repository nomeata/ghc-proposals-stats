GHC20xx data gathering and tallying scripts
===========================================

This directory contains a bunch of rather hacky scripts that I (nomeata) use to
produce the statistics about the extensions used to guide the committee
process, as well as tally the votes.

I run the `.hs` programs with `cabal run`.


In GHC2021/ exist the following files

 * `versions.csv`

   Produced with
   ```
   ./parse-docs.pl ~/build/haskell/ghc/docs/users_guide/**/*.rst > GHC2021/versions.csv
   ```
   with a recent check-out of GHC

 * `hackage-totals.csv` and `hackage-data.csv`

   Produced by downloading hackage packages with
   ```
   ./hackage-download.sh
   ```
   (careful, multiple GB!) and then running
   ```
   cabal run hackage-count -- ../../hackage/*/
   ```

 * `haskell-survey-results.csv`

   obtained from Taylor Fausak, who ran the State of Haskell Survey. We only
   care about one specific column (`s2q5`)


 * Files with votes: TBD

 * `result.rst`

   restructuredText table, ready for pasting into the GHC proposal, generated by
   ```
   cabal run merge
   ```

The repo is set up for quick experimentation with the data in GHCI, e.g. to find out the least popular extensions:
```
$ git clone https://github.com/nomeata/ghc-proposals-stats.git
$ cd ghc-proposal-stats/tools/ext-stats
$ cabal repl merge
â€¦
*Main> :set -XRecordWildCards
*Main> D{..} <- loadD
*Main> :info D
data D
  = D {Main.hackage_parsed :: Int,
       Main.hackage_in_cabal_total :: Int,
       Main.survey_total :: Int,
       Main.exts :: M.Map String E}
*Main> :info E
data E
  = E {ext :: String,
       since :: String,
       hackage_used :: Int,
       hackage_in_cabal :: Int,
       hackage_mod_use :: Int,
       survey_yes :: Int,
       survey_no :: Int}
*Main> length exts
116
*Main> mapM_ (\E{..} -> Text.Printf.printf "%s: %d\n" ext survey_no) $ take 10 $ reverse $ sortOn (\E{..} -> survey_no) (M.elems exts)
AllowAmbiguousTypes: 195
CPP: 192
IncoherentInstances: 176
Arrows: 156
Strict: 153
ImplicitParams: 147
UndecidableInstances: 144
OverlappingInstances: 144
Unsafe: 139
TemplateHaskell: 137
```
